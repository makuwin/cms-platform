---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCookieValue } from '../utils/cookies';

export const prerender = false;

const apiBase = import.meta.env.PUBLIC_API_BASE_URL ?? "http://localhost:3000";
const normalizedBase = apiBase.replace(/\/$/, "");
const cookieHeader = Astro.request.headers.get("cookie");
const accessToken = getCookieValue(cookieHeader, 'access_token');

let initialUser:
  | {
      id: string;
      name?: string | null;
      email?: string | null;
      role?: string | null;
    }
  | null = null;

if (cookieHeader) {
  try {
    const meResponse = await fetch(`${normalizedBase}/api/auth/me`, {
      headers: {
        Accept: "application/json",
        cookie: cookieHeader,
        ...(accessToken ? { Authorization: `Bearer ${accessToken}` } : {}),
      },
    });
    if (meResponse.ok) {
      const payload = await meResponse.json();
      initialUser = payload?.user ?? null;
    }
  } catch {
    initialUser = null;
  }
}
---

<BaseLayout
  initialUser={initialUser}
  title="NovaCMS | Modern Content Platform"
  bodyClass=""
>
  <main class="mx-auto max-w-5xl px-6 py-12 sm:px-8">
    <section class="grid items-center gap-10 md:grid-cols-[minmax(0,1.1fr)_minmax(0,0.9fr)]">
      <div class="flex flex-col gap-6">
        <h1 class="text-4xl font-bold text-slate-900 md:text-5xl">Launch your content universe in minutes</h1>
        <p class="text-lg leading-relaxed text-slate-600">
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla sed sem vitae mauris porta mattis.
          Curabitur dictum mi sit amet mauris dictum venenatis.
        </p>
        <div class="flex flex-wrap gap-4">
          <a
            class="inline-flex items-center justify-center rounded-full bg-indigo-500 px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-indigo-500/30 transition hover:-translate-y-0.5 hover:bg-indigo-600"
            href="/sign-up"
          >
            Start Your Trial
          </a>
          <a
            class="inline-flex items-center justify-center rounded-full border border-slate-200 px-6 py-3 text-sm font-semibold text-slate-700 transition hover:border-indigo-200 hover:text-indigo-600"
            href="/learn-more"
          >
            View Product Tour
          </a>
        </div>
      </div>
      <div class="overflow-hidden rounded-2xl shadow-2xl shadow-slate-500/20">
        <img
          class="w-full object-cover"
          src="https://picsum.photos/seed/dashboard/640/420"
          alt="Product dashboard mockup"
        />
      </div>
    </section>

    <section class="mt-16 grid gap-8 md:grid-cols-3">
      <article class="flex flex-col gap-4 rounded-2xl bg-white p-6 shadow-xl shadow-slate-200 ring-1 ring-slate-100">
        <img class="w-full rounded-xl object-cover" src="https://picsum.photos/seed/editor/420/280" alt="Content editor preview" />
        <h2 class="text-xl font-semibold text-slate-900">Effortless Editing</h2>
        <p class="text-slate-600">
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi sed dignissim turpis, vel pellentesque neque.
        </p>
      </article>
      <article class="flex flex-col gap-4 rounded-2xl bg-white p-6 shadow-xl shadow-slate-200 ring-1 ring-slate-100">
        <img class="w-full rounded-xl object-cover" src="https://picsum.photos/seed/analytics/420/280" alt="Analytics charts" />
        <h2 class="text-xl font-semibold text-slate-900">Actionable Insights</h2>
        <p class="text-slate-600">
          Quisque ultrices lorem eget libero pulvinar, non ultrices ligula dictum. Integer in velit vel sem tincidunt pellentesque.
        </p>
      </article>
      <article class="flex flex-col gap-4 rounded-2xl bg-white p-6 shadow-xl shadow-slate-200 ring-1 ring-slate-100">
        <img class="w-full rounded-xl object-cover" src="https://picsum.photos/seed/collaboration/420/280" alt="Collaboration tools" />
        <h2 class="text-xl font-semibold text-slate-900">Team Collaboration</h2>
        <p class="text-slate-600">
          Sed sit amet ligula ac nunc feugiat ornare. Mauris nibh metus, gravida euismod porttitor et, vestibulum ac arcu.
        </p>
      </article>
    </section>

    <section class="mt-16 flex flex-col gap-5 rounded-3xl bg-indigo-600 px-8 py-10 text-indigo-50 shadow-2xl shadow-indigo-500/30 ring-1 ring-indigo-500/40 md:flex-row md:items-center md:justify-between">
      <div class="space-y-3">
        <h2 class="text-2xl font-semibold">Ready to shape your next release?</h2>
        <p class="max-w-xl text-indigo-100">
          Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Suspendisse ut tellus
          vitae lacus ullamcorper tristique.
        </p>
      </div>
      <a
        class="inline-flex items-center justify-center rounded-full bg-white px-6 py-3 text-sm font-semibold text-indigo-600 shadow-lg shadow-indigo-500/30 transition hover:-translate-y-0.5 hover:bg-indigo-50"
        href="/contact"
      >
        Book a Demo
      </a>
    </section>
</main>
</BaseLayout>
