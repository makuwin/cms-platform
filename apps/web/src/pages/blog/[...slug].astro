---
import Layout from '../../layouts/ArticleLayout.astro';
import Comments from '../../components/react/Comments.tsx';
import ShareButtons from '../../components/react/ShareButtons.tsx';
import { getArticles, getArticle } from '../../lib/api';

export const prerender = true;
export const revalidate = 60;

export async function getStaticPaths() {
  const articles = await getArticles();
  return articles.map((article) => ({
    params: { slug: article.slug.split('/') }
  }));
}

const slugParam = Astro.params.slug;
const slug = Array.isArray(slugParam) ? slugParam.join('/') : slugParam;
const article = await getArticle(slug);
---

<Layout title={article.title}>
  <article class="space-y-10">
    <header class="space-y-3">
      <p class="text-sm uppercase tracking-wide text-primary-300">
        {article.author?.name ?? 'CMS Team'}
      </p>
      <h1 class="text-4xl font-bold text-neutral-50">{article.title}</h1>
      <p class="text-xs text-neutral-400">
        Published {article.publishedAt
          ? new Date(article.publishedAt).toLocaleDateString()
          : 'draft'}
      </p>
    </header>

    <div class="prose prose-invert max-w-none" set:html={article.content} />

    <ShareButtons client:visible url={Astro.url} title={article.title} />

    <Comments client:idle articleId={article.id} />
  </article>
</Layout>
